# 数据链路层 - 数据链路控制

- 简介

  数据链路层的两个主要功能是

  + 数据链路控制

    处理两个邻近节点之间的通信，即节点到节点通信的设计和程序

    功能：

    * 成帧
    * 流量控制
    * 差错控制
    * 提供帧在节点之间流畅且可靠传输的软件实现协议

  + 介质访问控制

    如何共享链路

## 成帧

- 简介

  位于物理层的数据传递是指**以信号的形式从源端传输到目的端**

  物理层提供**位同步**以保证发送方和接收方能使用相同的位周期和时序。

  数据链路层需将位**组合成帧**，并使帧与帧之间是可识别的。

  在数据链路层中，通过添加发送方地址和接收方地址，**成帧**(framing)将一条从源端到目的端的报文分离开来，或者将到不同目的端的报文分离开来。

  **目的地址**定义了分组要去的地方，而**发送方地址**帮助接收方确认接收。

  尽管整条报文都应该分组为一个帧，但通常却不这么做。一个原因是一个帧会很大，将使得流量和差错控制变得十分低效。当一个巨大的帧承载一条报文时，即使一个字节的错误也需要重新传递整条报文。

### 固定长度成帧

- 简介

  不需要定义帧的边界，长度本身就可以用作分隔符

### 可变长度成帧

- 简介

  在可变长度成帧中，需要规定一个帧的结束和下一个帧的开始

#### 面向字符协议

- 面向字符协议中的帧

  ![面向字符协议中的帧](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/dataLinkControl/20201224234904.png)

  + 头部通常携带**源端地址和目的端地址以及其他控制信息**
  + 尾部携带**检错或纠错冗余位**，也是8位的倍数
  + 为了将一个帧与下ー个分离开来，在帧的开始和结束增加了8位(1字节)的**标记**(flag)。标记由与协议相关的特殊字符组合而成，标明一个帧的开始和结束。

- 字节填充

  ![字节填充和移除](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/dataLinkControl/20201225001951.png)

  如果存在与标记相同模式的字符，便在帧的数据部分填入一个特殊的字节，数据段被填入一个额外的字节，这个字节被称为**换义字符ESC**

  接收方遇到转义字符时，便会将它从数据段移走，并仍将下一字符作为数据处理，而不是当作分界的标记

  如果换义字符是文本的一部分，那么要增加额外的换义字符来表明第二个换义字符是文本的一部分

  问题：如今广泛应用的编码系统，例如 Unicode 有 16 位和 32 位字符，就会与 8 位字符产生冲突

#### 面向位协议

- 面向位协议中的帧

  ![面向位协议中的帧](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/dataLinkControl/20201225002504.png)

  + 使用一个特殊的 8 位模式的标记 01111110 作为分隔符来标明帧的开始和结束

- 位填充

  ![位填充和移除](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/dataLinkControl/20201225002937.png)

  通过填充一个简单的位使得这个模式区别于标记

  当遇到 1 个 0 和 5 个连续的 1，边增加一个 0，这个额外填充的位最终被接收方移走

  在 1 个 0 和 5 个连续的 1 后面添加 1 个额外的位而不管接下来那个位是什么

## 流量控制

流量控制就是一系列程序，用来限制发送方在等到确认之前发送的数据数量。

## 差错控制

数据链路层的差错控制基于自动重复请求，即重传数据ARQ