# 物理层 - 数字传输

## 数字信号

信息在计算机网络的网络结点中传送时，需要转换为数字信号或者模拟信号

### 数字到数字转换技术

将数字数据转换为数字信号

使用数字信号表示数字数据涉及的三种技术：线路编码、块编码和扰动

#### 线路编码~~（这一块的笔记是失败的，太详细了，应该为图像为主，赋以解释说明）~~

- 简述

  假定以文本、数字、图形、音频或视频为形式的数据在计算机内存中都是以位序列形式保存的，线路编码将位序列转换为数字信号

- 线路编码示例

  ![线路编码和解码实例图](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201214233308.png)

  + 发送方

    数字数据经过编码器被编码成数字信号

  + 接收方

    数字信号经过解码器解码重新生成原数字数据

- 信号元素与数据元素
  + 数据元素 ***data element***
  
    表示一块信息的最小实体，即位
  
  + 信号元素 ***signal element***
  
    信号元素承载数据单元，信号元素是数字信号的最小单元
  
  - 关联
  
    数据元素是我们需要发送的，信号元素是我们能发送的
  
    数据元素是被承载的，信号元素是载体
  
    **比率 r** 每个信号元素承载的数据元素的数量
  
    ![不同的比率 r](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215090546.png)
  
  + tzy
  
    数据元素：人为的编码，规定成0/1或者其他的编码方式
  
    信号元素：一个电平就是一个信号元素
  
    比率r：人为规定的编码位数 与 固定的信号元素的比值（数据元素/信号元素，比特率/波特率）

- 数据速率和信号速率

  + 数据速率 data rate

    1秒发送的数据元素（位）的数量，单位是每秒位（bps）

    另称：

    比特率 bit rate

  + 信号速率 signal rate

    1秒发送的信号元素的数量，单位是波特（baud）

    另称：

    脉冲速率 pulse rate

    调制速率 modulation rate

    波特率 baud rate

  + 数据通信的目标

    * 增加数据速率

      增加传输速度

    * 降低信号速率

      降低带宽需求

    * 类比

      使用更少的车（信号元素），运送更多的人（数据元素）

  + 数据速率和信号速率
    $$
    S = c * N * 1/r \quad (baud)\\
    N:数据速率(bps)\\
    c:情形因子\\
    S:信号元素数量\\
    r:比率，每个信号元素承载的数据元素的数量
    $$

- 带宽

  带宽理论上是无限的，但有效的带宽是有限的

  波特率决定了数字信号的带宽（类比：是车辆数量影响了交通，而不是运输的人数）

  信号中更多的变化意味着在信号中插入了更多的频率，带宽影响了我们所需的频率范围，带宽是一个复杂的概念，通常将带宽定义为频率范围（重点在于 范围位于哪里，最低频率和最高频率，另：振幅或相位也是一个重要的问题——需要带宽的图表来表现有关带宽的更多的信息）

  + 计算公式

    $$
    带宽B（频率范围）与信号速率N（波特率）成正比\\

    这里的N是数据速率吧？还是信号速率？\\

    最小带宽B_{min} = c * N * 1/r\\
    最大数据速率N_{max} = 1/c * B * r
    $$

  + 奈奎斯特公式
    $$
    通道的最大数据速率 N_{max} = 2 * B * log_2L\\
    与上述的计算公式的关系\\
    N_{max} = 1/c * B * r (c=1/2,r=log_2L)\\
    =2 * B * log_2L
    $$

- 基线偏移

  * 基线

    在解码数字信号时，接收方计算接收到信号功率的运行平均值，这个平均值称为 **基线**

    输入信号的功率会与基线比较来确定数据元素的值，一个0或1的长字符串会引起基线偏移，使得接收方不能正确的进行解码

  + 直流成分

    当数字信号中的电平保持一段时间的恒定时，频谱会产生很低的频率，这些接近于0的频率称为**DC(直流)成分**，会给不允许通过低频率的系统或者使用电子耦合的系统带来问题

    对于这些系统，我们使用无直流成分的方案

  + 自同步

    如果双方的时钟不匹配，位间隔就不会匹配，接收方可能会错误的解释信号

    缺乏同步的结果示例

    ![image-20201215120023112](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215120026.png)

    数字信号在传输的数据中包含有定时信息，如果信号中包含有提示接收方起始、中间和结束位置的脉冲的跳变就可以完成自同步。如果接收方的时钟不同步，这些提示跳变就会将接收方的时钟复位。

- 编码特性

  + 内置差错检测

    来检测传输过程中发生的一些差错

  + 抗噪声和抗干扰的能力

  + 复杂性

#### 线路编码方案

|           编码方案           |                             特征                             |                           电平定义                           | 图片示例                                                     |                           优、缺点                           |
| :--------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | ------------------------------------------------------------ | :----------------------------------------------------------: |
|         单极编码方案         |          所有的信号电平都在时间轴的一边(上面/下面)           |                                                              |                                                              |                                                              |
|         极性编码方案         |                      电平在时间轴的两边                      |                    正电平-0<br />负电平-1                    |                                                              |                                                              |
|          双极性方案          |                   三个电平-正值、负值和零                    | 一个数据元素的电平是0，而另一个数据元素的电平在正值、负值间交替 |                                                              |                                                              |
|         不归零(NRZ)          |                     位中间信号不会回到零                     |                      正电平-1，零电平-0                      |                                                              |                                                              |
|         归零编码(RZ)         |            信号不在两个位之间变化，而是在位中变化            |                  使用三个值：正值、负值和零                  |                                                              | 缺点：需要两个信号变化来编码一个位，占用更大的带宽；复杂；没有DC直流成分 |
|            非差分            |                        电平值决定位值                        |                                                              |                                                              |                                                              |
|             差分             |                     电平是否跳变决定位值                     |                                                              |                                                              |                                                              |
|          多电平方案          | 通过把m个数据元素的模式编码成n个信号元素的模式，增加每波特的位数 |                                                              |                                                              |                                                              |
|                              |                                                              |                                                              |                                                              |                                                              |
|            极性RZ            |                                                              |                                                              | ![极性RZ编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215162002.png) |                                                              |
|         极性NRZ编码          |                    信号的振幅使用两个电平                    |                                                              |                                                              |                                                              |
|      NRZ-L(NRZ电平编码)      |                      信号电平决定了位值                      |                                                              | ![极性NRZ-L方案和极性NRZ-I方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215161017.png) | 如果有全0或全1的长序列，平均信号功率就会变斜，接收方辨别位值就会较困难；同步问题（全0/1的长序列）；当系统中的极性意外改变时，可能会将所有的0解释为1或所有的1解释为0 |
|      NRZ-I(NRZ反相编码)      |              信号电平是否反相转或跳变决定了位值              |                     没有跳变-0，有跳变-1                     |                                                              | 全0的长序列中，会出现问题 - 消除全0的长序列，就可以避免基线偏移；同步问题（全0的长序列） |
|       曼切斯特编码方案       |                      信号电平决定了位值                      | 位的持续时间被二等分，在前半部分电平保持一个水平，后半部分变成另一个水平，位中间的跳变提供了同步 | ![曼切斯特编码和差分曼切斯特编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215162431.png) |                                                              |
|         差分曼切斯特         |              信号电平是否反相转或跳变决定了位值              | 在位中间中总是有一个跳变，但是位值在位开始时确定，如果下一个位是0，就有一个跳变，如果下一个位是1，则没有跳变 |                                                              |      没有基线偏移，没有DC成分<br />信号速率是NRZ的两倍       |
|    双极交替传号反转(AMI)     |                                                              | 交替的1的反换，中值0电平表示二进制0，二进制1由交替正负电平表示 | ![AMI和伪三元码](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215163027.png) |                                                              |
|          伪三元编码          |                                                              |            位1编码成0电平、位0编码成交替正负电平             |                                                              |  全1序列-电平在正负值间交替，全0序列-振幅为0，都没有DC成分   |
|             2B1Q             |       使用长度为2的2位数据模式编码成一个4电平信号元素        |                                                              | ![2B1Q编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215164344.png) |                                                              |
|             8B6T             |                把8位模式编码成6个信号元素模式                |                                                              | ![8B6T编码](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215200319.png) |                                                              |
| 4维5级3脉冲振幅调制4D - PAM5 | 数据同时通过4条线路发送，使用5个电平（电平0只用于发送差错检测） |                                                              | ![4D-PAM5方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215165426.png) |                                                              |
|       多线路传输 MLT-3       |      使用三个电平（+V 0 -V）和三个跳变规则在电平间变动       | 跳变规则：<br/>  1. 下一位是0 - 没有跳变<br/>  2. 下一位是1且当前电平不是0 - 下一个电平是0<br/>  3. 下一位是1且当前电平是0 - 下一个电平是最后一个非零电平的相反值 | ![MLT-3方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215172629.png) |                                                              |

- 单极编码方案

  所有的信号电平都在时间轴的一边，或者时间轴的上面或者时间轴的下面

- 不归零

  位中间信号不会回到零

  一般，单极编码方案设计成不归零(non-return-to-zero NRZ)方案

  定义：正电平-1，零电平-0

- 极性编码方案

  电平在时间轴的两边

  定义：0的电平-正，1的电平-负

  + 不归零编码

    极性NRZ编码中，信号的振幅使用两个电平

  + NRZ-L (NRZ-Level)

    NRZ电平编码

    信号电平决定了位值

    问题：如果有全0或全1的长序列，平均信号功率就会变斜，接收方辨别位值就会较困难；同步问题（全0/1的长序列）；当系统中的极性意外改变时，可能会将所有的0解释为1或所有的1解释为0

  + NRZ-I (NRZ-Invert)

    差分编码

    NRZ反相编码

    信号电平是否反相转或跳变决定了位值

    定义：没有跳变-0，有跳变-1
    
    问题：全0的长序列中，会出现问题 - 消除全0的长序列，就可以避免基线偏移；同步问题（全0的长序列）
  
  + NRZ-L和NRZ-I的示例图
  
    ![极性NRZ-L方案和极性NRZ-I方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215161017.png)
  
    虽然平均信号速率为N/2，但携带了高电平能量的DC成分，

- 归零编码（RZ）

  使用三个值：正值、负值和零

  信号不在两个位之间变化，而是在位中变化

  缺点：需要两个信号变化来编码一个位，占用更大的带宽；复杂

  没有DC直流成分

  ![极性RZ编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215162002.png)

- 双相编码

  曼切斯特编码方案：RZ（位中间跳变）+NRZ-L

  位的持续时间被二等分，在前半部分电平保持一个水平，后半部分变成另一个水平，位中间的跳变提供了同步

  差分曼切斯特：RZ+NRZ-I 

  差分编码

  在位中间中总是有一个跳变，但是位值在位开始时确定，如果下一个位是0，就有一个跳变，如果下一个位是1，则没有跳变

  ![曼切斯特编码和差分曼切斯特编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215162431.png)

  优点：没有基线偏移，没有DC成分

  缺点：信号速率是NRZ的两倍

- 双极性方案

  双极编码（也称多电平二进制）：三个电平-正值、负值和零，一个数据元素的电平是0，而另一个数据元素的电平在正值、负值间交替

  + AMI和伪三元编码

    双极交替传号反转（AMI）：交替的1的反换，中值0电平表示二进制0，二进制1由交替正负电平表示

    伪三元编码：位1编码成0电平、位0编码成交替正负电平

    ![AMI和伪三元码](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215163027.png)

    全1序列-电平在正负值间交替，全0序列-振幅为0，都没有DC成分

- 多电平方案

  通过把m个数据元素的模式编码成n个信号元素的模式，增加每波特的位数

  m个数据元素组 - $2^m$ 个数据模式组合

  L个不同电平、n个信号元素 - $L^n$ 个信号模式组合

  $2^m < L^n$ 数据模式能占据一个信号模式的子集，可以通过设计该子集来避免基线偏移、提供同步并检测数据传输中出现的差错

  $mBnl$ 编码类型，m - 二进制模式的长度，B - 二进制数据， n - 信号模式的长度， L - 信号中的电平数 （L=2 - 二元 - B，L=3 - 三元 - T，L=4 - 四元 - Q）

  + 2B1Q

    使用长度为2的2位数据模式编码成一个4电平信号元素

    $2^2 -> 4^1$

    ![2B1Q编码方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215164344.png)

  + 8B6T

    把8位模式编码成6个信号元素模式

    $2^8=256 -> 3^6=478$

    冗余的信号元素：提供同步和差错检测，DC平衡

    ![8B6T编码](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215200319.png)

  + 4D - PAM5

    4维5级3脉冲振幅调制：数据同时通过4条线路发送，使用5个电平（电平0只用于发送差错检测）

    ![4D-PAM5方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215165426.png)

- 多线路传输 MLT-3

  如果信号的电平多于两个，可以设计一种多于两个跳变规则的差分编码方案

  三电平多线路传输（MLT-3）使用三个电平（+V 0 -V）和三个跳变规则在电平间变动

  ![MLT-3方案](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215172629.png)

  跳变规则：

  1. 下一位是0 - 没有跳变
  2. 下一位是1且当前电平不是0 - 下一个电平是0
  3. 下一位是1且当前电平是0 - 下一个电平是最后一个非零电平的相反值

- 总结

  ![image-20201215200459183](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215200501.png)

  ![image-20201215200513316](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201215200514.png)

#### 块编码 block coding

利用冗余以确保同步，并提供一些内在的差错检测

把m位的块变成n位的块（n>m），称为mB/nB编码技术（/用以区别多电平编码）

增加了比特率（数据发送的位数变多）

![块编码概念图](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201216122939.png)

块编码涉及的三个步骤：分组、置换和组合

- 4B/5B

  与NRZ-I组合使用

  NRZ-I有同步问题，连续的0的长序列会让接收方失去同步——在使用NRZ-I编码前改变位流

  -经过块编码的流不会有多于三个连续的0

  将4位输入置换为5位输出仅包含不超过一个前导0（左边的位）和两个后缀0（右边的位）- 最多只会有三个连续的0

  特点：解决了同步问题，克服了NRZ-I的缺陷，但增加了NRZ-I的信号速率，冗余位增加了20%的波特（4B->5B），没有解决NRZ-I的DC成分，如果DC成分不可接受，就需要使用双相或双极编码方案

- 8B/10B

  是5B/6B编码和3B/4B编码的组合

  不均等性控制器，观察0比1多（或1比0多），如果当前块中的位产生了不均等性，而该不均等性对上一块的不均性有影响，那么当前块的所有位取反

#### 扰动

不会增长位数并提供同步的技术，以及一种把0电平脉冲置换成其他电平组合来提供同步的解决方法——其中一种就是扰动（基于AMI规则，有一定的修改）

相对于块编码，扰动与编码同时完成，系统需要基于定义好的扰动规则插入所需脉冲

- B8ZS

  8零置换的双极编码方案，8个连续的0电平会被替换为000VB0VB（V-违反了AMI编码规则，B-与AMI规则相一致的非零电平）（V-与前一个非零脉冲极性相同的极性，B-与前一个非零脉冲极性相反的极性）

  ![B8ZS扰动技术](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201216170604.png)

- HDB3

  高密度双极3零方案，4个连续零电平被置换成000V或B00V

  使非零脉冲总数为偶数——如果最后一次置换后的非零脉冲是奇数-置换模式为000V，如果最后一次置换后的非零脉冲是偶数-置换模式为B00V

  ![HDB3扰动技术](https://gitee.com/twilight_h_1184651848/pic-go-img/raw/master/computerNetworks/digitalTransmission/20201216171136.png)

### 模拟到数字转换技术

将模拟数据转换为数字数据

### 传输模式

